#!/usr/bin/env bash

# Note: this script assumes you are running it from the root of the repo
# using ./bin/integration you may pass additional flags and args, which
# will be added to the final './bin/test -tags=integration' command.

set -eu

DESC_FILE="$PWD/qa_desc.json"

if [ ! -f "$DESC_FILE" ]; then
	(
		cd ./dev_support/sous_qa_setup
		go build
		./sous_qa_setup --compose-dir ../../integration/test-registry --out-path "$DESC_FILE"
	)
fi

SOUS_QA_DESC="$PWD/qa_desc.json" ./bin/test -tags=integration "$@"

