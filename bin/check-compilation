#!/usr/bin/env sh

go list ./... | grep -vE '/vendor/' | (
	while read -r P; do	
		FAILED=NO
		# compile the package itself
		if ! BUILDOUT=$(go build -o /dev/null "$P" 2>&1); then
			FAILED=YES
			printf "Compile Failed for %s:" "$P"
			echo "$BUILDOUT"
		fi
		# compile the package's tests
		if ! TESTBUILDOUT=$(go test -c -o /dev/null "$P" 2>&1); then
			FAILED=YES
			printf "Compile Tests failed for %s:" "$P"
			echo "$TESTBUILDOUT"
		fi
		if [ "$FAILED" = NO ]; then
			echo "OK: $P"
		else
			echo "FAILED: $P"
		fi
	done
)
